"use strict"
let url = require("url")
let request = require("request");
let tokenModule = require("./token");
let api = require("./api-server");
let param = global.atworkCfg;
let fuzzyQueryByAccountName = function(accountName) {
	let doFuzzyQuery = (success, fail)=>{
		let sendRequestWithToken = function(accessToken){
			let arg = {
				method: "GET",
				uri: url.resolve(param.apiServer, `organization/employee?matching=false&query=${accountName}&access_token=${accessToken}`)
			};
			let callbacks = {
				success:success,
				fail:fail
			};
			api.getSendRequestFunc(arg, callbacks, param.maxRetries)();
		}
		tokenModule.getAccessToken().then(sendRequestWithToken).catch(fail);
	}
	return new Promise(doFuzzyQuery);
}
module.exports = {
	fuzzyQueryByAccountName: fuzzyQueryByAccountName
}